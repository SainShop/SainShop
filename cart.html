<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Корзина</title>
    <link rel="stylesheet" href="stylecart.css">
</head>

    <header>
        <div class="logo">
            <a href="index.html">
                <img src="logo.png" alt="SainShop Logo">
            </a>
        </div>
    </header>

<body>
    <div class="cart-container" id="cartContainer">
        <h2>Корзина</h2>
        <div id="cartItems"></div>
        <button class="complete-order" onclick="completeOrder()">Оформить заказ</button>

    <div class="spacer"></div>
        
    </div>

<script>
// Получение содержимого корзины
function getCartItems() {
    const items = [];
    const cartItems = document.querySelectorAll(".cart-item");
    cartItems.forEach(item => {
        const optionsElement = item.querySelector('.cart-item-options');
        const options = optionsElement ? optionsElement.innerText : "Неизвестные опции";
        items.push({ options });
    });
    return items;
}

// Завершение заказа
function completeOrder() {
    const orderNumber = Math.floor(10000 + Math.random() * 90000); // Случайный номер заказа
    const telegramUsername = getTelegramUsername(); // Получаем имя пользователя из Telegram
    const cartItems = JSON.parse(localStorage.getItem("cart")) || []; // Загружаем текущий заказ

    if (cartItems.length === 0) {
        showCustomAlert("Ваша корзина пуста. Добавьте товары перед оформлением заказа.");
        return;
    }

    const data = {
        username: telegramUsername,
        order: cartItems,
        orderNumber: orderNumber
    };

    // Отправляем данные в Google Таблицы
    fetch("https://script.google.com/macros/s/AKfycbz6KgMNLvApLxMlakNMcNM316udIlvCQImxuYTbhS25ygVfCw09WSS26ssnTJJvrGXi/exec", {
        method: "POST",
        body: JSON.stringify(data),
        headers: {
            "Content-Type": "application/json"
        }
    })
        .then(response => {
            if (response.ok) {
                showCustomAlert(`Ваш номер заказа ${orderNumber}. Наш менеджер свяжется с вами для уточнения деталей.`);
                localStorage.removeItem("cart"); // Очищаем корзину после успешного заказа
                updateCartUI(); // Обновляем UI корзины
            } else {
                showCustomAlert("Ошибка отправки данных. Попробуйте снова.");
            }
        })
        .catch(error => {
            console.error("Ошибка:", error);
            showCustomAlert("Ошибка отправки данных. Попробуйте снова.");
        });
}


function getTelegramUsername() {
    if (window.Telegram && Telegram.WebApp.initDataUnsafe) {
        return Telegram.WebApp.initDataUnsafe.user?.username || "Неизвестный пользователь";
    }
    return "Неизвестный пользователь";
}

function showCustomAlert(message) {
    const alertBox = document.createElement("div");
    alertBox.textContent = message;
    alertBox.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #333;
        color: #fff;
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 1000;
    `;
    document.body.appendChild(alertBox);
    setTimeout(() => alertBox.remove(), 3000);
}
    

// Функция для обновления интерфейса корзины
function updateCartUI() {
    const cartContainer = document.getElementById("cartItems");
    cartContainer.innerHTML = ""; // Очистить содержимое корзины

    // Получаем содержимое корзины из localStorage
    const cart = JSON.parse(localStorage.getItem("cart")) || [];

    if (cart.length === 0) {
        cartContainer.innerHTML = "<p>Ваша корзина пуста.</p>";
        return;
    }

    // Отображаем каждую добавленную опцию
    cart.forEach((option, index) => {
        const cartItem = document.createElement("div");
        cartItem.className = "cart-item";
        cartItem.innerHTML = `
            <span class="cart-item-options">${option}</span>
            <button class="remove-btn" onclick="removeFromCart(${index})">Удалить</button>
        `;
        cartContainer.appendChild(cartItem);
    });
}

function removeFromCart(index) {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart.splice(index, 1); // Удаляем выбранный элемент
    localStorage.setItem("cart", JSON.stringify(cart)); // Сохраняем обновленную корзину
    updateCartUI(); // Обновляем UI корзины
}


// Инициализация корзины
updateCartUI();
</script>

</body>

 <footer>
        <a href="index.html" class="footer-button active">
            <img src="home.png" alt="Icon 1">
            <span>Главная</span>
        </a>
        <a href="cart.html" class="footer-button">
            <img src="cart.png" alt="Icon 2">
            <span>Корзина</span>
        </a>
        <a href="https://t.me/manager_sainshop" class="footer-button">
            <img src="manager.png" alt="Icon 3">
            <span>Менеджер</span>
        </a>
        <a href="https://t.me/sain_shop" target="_blank" class="footer-button">
            <img src="telegram.png" alt="Icon 4">
            <span>Telegram</span>
        </a>
    </footer>

</html>
