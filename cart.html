<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Корзина</title>
    <link rel="stylesheet" href="stylecart.css">
</head>

    <header>
        <div class="logo">
            <a href="index.html">
                <img src="logo.png" alt="SainShop Logo">
            </a>
        </div>
    </header>

<body>
    <div class="cart-container" id="cartContainer">
        <h2>Корзина</h2>
        <div id="cartItems"></div>
        <button class="complete-order" onclick="completeOrder()">Оформить заказ</button>

    <div class="spacer"></div>
        
    </div>

<script>
// Получение содержимого корзины
function getCartItems() {
    const items = [];
    const cartItems = document.querySelectorAll(".cart-item");
    cartItems.forEach(item => {
        const optionsElement = item.querySelector('.cart-item-options');
        const options = optionsElement ? optionsElement.innerText : "Неизвестные опции";
        items.push({ options });
    });
    return items;
}

// Завершение заказа
function completeOrder() {
    const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    if (cartItems.length === 0) {
        showCustomAlert("Ваша корзина пуста.");
        return;
    }

    const username = window.Telegram?.WebApp?.initDataUnsafe?.user?.username || "Гость";
    const orderNumber = Math.floor(10000 + Math.random() * 90000); // Генерация номера заказа

    const data = {
        username: username,
        order: cartItems,
        orderNumber: orderNumber
    };

    fetch("https://script.google.com/macros/s/AKfycbwblK4sybxKtkAx9KOnQUDxf_0-KNuRidw7xjHSymADCKEfc8jMdFSi_Jy6haodwh_A3w/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.status === "success") {
            showCustomAlert(`Ваш номер заказа: ${orderNumber}. Наш менеджер свяжется с вами.`);
            localStorage.removeItem('cart'); // Очистка корзины
            displayCart(); // Обновление отображения корзины
        } else {
            showCustomAlert("Ошибка на сервере. Попробуйте снова.");
        }
    })
    .catch(error => {
        console.error("Ошибка:", error);
        showCustomAlert("Ошибка отправки данных. Попробуйте снова.");
    });
}


function getTelegramUsername() {
    if (window.Telegram && Telegram.WebApp.initDataUnsafe) {
        return Telegram.WebApp.initDataUnsafe.user?.username || "Неизвестный пользователь";
    }
    return "Неизвестный пользователь";
}

function showCustomAlert(message) {
    const alertBox = document.createElement("div");
    alertBox.textContent = message;
    alertBox.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #333;
        color: #fff;
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 1000;
    `;
    document.body.appendChild(alertBox);
    setTimeout(() => alertBox.remove(), 3000);
}
    

// Функция для обновления интерфейса корзины
function updateCartUI() {
    const cartContainer = document.getElementById("cartItems");
    cartContainer.innerHTML = ""; // Очистить содержимое корзины

    // Получаем содержимое корзины из localStorage
    const cart = JSON.parse(localStorage.getItem("cart")) || [];

    if (cart.length === 0) {
        cartContainer.innerHTML = "<p>Ваша корзина пуста.</p>";
        return;
    }

    // Отображаем каждую добавленную опцию
    cart.forEach((option, index) => {
        const cartItem = document.createElement("div");
        cartItem.className = "cart-item";
        cartItem.innerHTML = `
            <span class="cart-item-options">${option}</span>
            <button class="remove-btn" onclick="removeFromCart(${index})">Удалить</button>
        `;
        cartContainer.appendChild(cartItem);
    });
}

function removeFromCart(index) {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart.splice(index, 1); // Удаляем выбранный элемент
    localStorage.setItem("cart", JSON.stringify(cart)); // Сохраняем обновленную корзину
    updateCartUI(); // Обновляем UI корзины
}


// Инициализация корзины
updateCartUI();
</script>

</body>

 <footer>
        <a href="index.html" class="footer-button active">
            <img src="home.png" alt="Icon 1">
            <span>Главная</span>
        </a>
        <a href="cart.html" class="footer-button">
            <img src="cart.png" alt="Icon 2">
            <span>Корзина</span>
        </a>
        <a href="https://t.me/manager_sainshop" class="footer-button">
            <img src="manager.png" alt="Icon 3">
            <span>Менеджер</span>
        </a>
        <a href="https://t.me/sain_shop" target="_blank" class="footer-button">
            <img src="telegram.png" alt="Icon 4">
            <span>Telegram</span>
        </a>
    </footer>

</html>
