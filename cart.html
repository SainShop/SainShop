<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞</title>
    <link rel="stylesheet" href="stylecart.css">
</head>

<header>
    <div class="logo">
        <a href="index.html">
            <img src="logo.png" alt="SainShop Logo">
        </a>
    </div>
</header>

<body>

    <div class="cart-container" id="cartContainer">
        <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
        <div id="cartItems"></div>
        <button class="complete-order" onclick="sendOrderToTelegram()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        <div class="spacer"></div>
    </div>

    <script>
        let username = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";

        // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ö—ç—à–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, #tgWebAppData=...)
        const hash = window.location.hash;

        if (hash) {
            const match = hash.match(/tgWebAppData=([^&]*)/);
            if (match) {
                const decodedData = decodeURIComponent(match[1]);
                const userMatch = decodedData.match(/user=([^&]*)/);

                if (userMatch) {
                    const userDataEncoded = decodeURIComponent(userMatch[1]);
                    const userData = JSON.parse(decodeURIComponent(userDataEncoded));
                    username = userData.username || "–ò–º—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ";
                    console.log("Username:", username);
                }
            }
        }

        // –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã
        function getCartItems() {
            const items = [];
            const cartItems = document.querySelectorAll(".cart-item");
            cartItems.forEach(item => {
                const optionsElement = item.querySelector('.cart-item-options');
                const options = optionsElement ? optionsElement.innerText : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–ø—Ü–∏–∏";
                items.push({ options });
            });
            return items;
        }

        function sendOrderToTelegram() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.length === 0) {
                alert("–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.");
                return;
            }

            const orderNumber = Math.floor(Math.random() * 100000);

            const messageText = `üõí *–ù–æ–≤—ã–π –∑–∞–∫–∞–∑:*\n` +
                `üë§ *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å*: ${username}\n` +
                `üì¶ *–ó–∞–∫–∞–∑*: ${cart.join(", ")}\n` +
                `üî¢ *–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞*: ${orderNumber}`;

            const telegramBotToken = "8005356500:AAFVIZCsVXz7xGxK2HgvsrZ0zIQkLz5vakQ";
            const chatId = "486886271";

            fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    chat_id: chatId,
                    text: messageText,
                    parse_mode: "Markdown"
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    alert("–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
                } else {
                    alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞.");
                }
            })
            .catch(console.error);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–æ—Ä–∑–∏–Ω—ã
        function updateCartUI() {
            const cartContainer = document.getElementById("cartItems");
            cartContainer.innerHTML = "";

            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            if (cart.length === 0) {
                cartContainer.innerHTML = "<p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</p>";
                return;
            }

            cart.forEach((option, index) => {
                const cartItem = document.createElement("div");
                cartItem.className = "cart-item";
                cartItem.innerHTML = `
                    <span class="cart-item-options">${option}</span>
                    <button class="remove-btn" onclick="removeFromCart(${index})">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                cartContainer.appendChild(cartItem);
            });
        }

        function removeFromCart(index) {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartUI();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        updateCartUI();
    </script>

</body>

<footer>
    <a href="index.html" class="footer-button active">
        <img src="home.png" alt="Icon 1">
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </a>
    <a href="cart.html" class="footer-button">
        <img src="cart.png" alt="Icon 2">
        <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
    </a>
    <a href="https://t.me/manager_sainshop" class="footer-button">
        <img src="manager.png" alt="Icon 3">
        <span>–ú–µ–Ω–µ–¥–∂–µ—Ä</span>
    </a>
</footer>

</html>
