<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞</title>
    <link rel="stylesheet" href="stylecart.css">
</head>

    <header>
        <div class="logo">
            <a href="index.html">
                <img src="logo.png" alt="SainShop Logo">
            </a>
        </div>
    </header>

<body>
    <div class="cart-container" id="cartContainer">
        <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
        <div id="cartItems"></div>
        <button class="complete-order" onclick="sendOrderToTelegram()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>

    <div class="spacer"></div>
        
    </div>

<script>
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–æ—Ä–∑–∏–Ω—ã
function getCartItems() {
    const items = [];
    const cartItems = document.querySelectorAll(".cart-item");
    cartItems.forEach(item => {
        const optionsElement = item.querySelector('.cart-item-options');
        const options = optionsElement ? optionsElement.innerText : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–ø—Ü–∏–∏";
        items.push({ options });
    });
    return items;
}

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
function sendOrderToTelegram() {
    // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram Mini App
    Telegram.WebApp.ready(); // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º WebApp
    const user = Telegram.WebApp.initDataUnsafe.user.username || null;

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ localStorage
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    if (cart.length === 0) {
        alert("–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.");
        return;
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
    const orderNumber = Math.floor(Math.random() * 100000);

    // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è Telegram
    const messageText = `üõí *–ù–æ–≤—ã–π –∑–∞–∫–∞–∑:*\n` +
        `üë§ *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å*: ${user}\n` +
        `üì¶ *–ó–∞–∫–∞–∑*: ${cart.join(", ")}\n` +
        `üî¢ *–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞*: ${orderNumber}`;

    const telegramBotToken = "8005356500:AAFVIZCsVXz7xGxK2HgvsrZ0zIQkLz5vakQ";
    const chatId = "486886271"; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π Telegram ID

    fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            chat_id: chatId,
            text: messageText,
            parse_mode: "Markdown"
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log("–û—Ç–≤–µ—Ç –æ—Ç Telegram:", data);
        if (data.ok) {
            alert("–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
        } else {
            alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞.");
        }
    })
    .catch(error => {
        console.error("–û—à–∏–±–∫–∞:", error);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑.");
    });
}



function getTelegramUsername() {
    if (window.Telegram && Telegram.WebApp.initDataUnsafe) {
        return Telegram.WebApp.initDataUnsafe.user?.username || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
    }
    return "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
}

function showCustomAlert(message) {
    const alertBox = document.createElement("div");
    alertBox.textContent = message;
    alertBox.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #333;
        color: #fff;
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 1000;
    `;
    document.body.appendChild(alertBox);
    setTimeout(() => alertBox.remove(), 3000);
}
    

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–æ—Ä–∑–∏–Ω—ã
function updateCartUI() {
    const cartContainer = document.getElementById("cartItems");
    cartContainer.innerHTML = ""; // –û—á–∏—Å—Ç–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã

    // –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ localStorage
    const cart = JSON.parse(localStorage.getItem("cart")) || [];

    if (cart.length === 0) {
        cartContainer.innerHTML = "<p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</p>";
        return;
    }

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∂–¥—É—é –¥–æ–±–∞–≤–ª–µ–Ω–Ω—É—é –æ–ø—Ü–∏—é
    cart.forEach((option, index) => {
        const cartItem = document.createElement("div");
        cartItem.className = "cart-item";
        cartItem.innerHTML = `
            <span class="cart-item-options">${option}</span>
            <button class="remove-btn" onclick="removeFromCart(${index})">–£–¥–∞–ª–∏—Ç—å</button>
        `;
        cartContainer.appendChild(cartItem);
    });
}

function removeFromCart(index) {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart.splice(index, 1); // –£–¥–∞–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
    localStorage.setItem("cart", JSON.stringify(cart)); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
    updateCartUI(); // –û–±–Ω–æ–≤–ª—è–µ–º UI –∫–æ—Ä–∑–∏–Ω—ã
}


// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã
updateCartUI();
</script>

</body>

 <footer>
        <a href="index.html" class="footer-button active">
            <img src="home.png" alt="Icon 1">
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        <a href="cart.html" class="footer-button">
            <img src="cart.png" alt="Icon 2">
            <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
        </a>
        <a href="https://t.me/manager_sainshop" class="footer-button">
            <img src="manager.png" alt="Icon 3">
            <span>–ú–µ–Ω–µ–¥–∂–µ—Ä</span>
        </a>
        <a href="https://t.me/sain_shop" target="_blank" class="footer-button">
            <img src="telegram.png" alt="Icon 4">
            <span>Telegram</span>
        </a>
    </footer>

</html>
